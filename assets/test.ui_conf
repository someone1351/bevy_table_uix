apply scroll_vbar
    color green
    hfill 1.0
    vfill 1.0
    span 1

    script
        var scroll_body self.parent.children.scroll_body.0;

        println "scroll_body {scroll_body}"

    node
        text -
        color blue
    node
        vfill 1.0
        vexpand 1.0

        node
            text =
            color red

            draggable
            #pressable

            #valign 0

            script
                var track self.parent;

                var start;

                set self.valign.p 0.0;
                #set self.valign.s 0.0;
                println "it is {}" self.vscroll.p


                self.add_event_listener "drag_begin" [fn (d) {
                    #set start self.valign.s;
                    #set start self.valign.p;

                    println track.computed.inner_size.y
                    println "offset is {}" d.offset.y

                    #(- d.offset)

                    set self.valign.p self.computed.cell.top
                    set start self.computed.cell.top
                }]
                self.add_event_listener "drag_end" [fn () {
                    #println "drag_end {} {}" self.valign.p self.valign.s
                    #set self.valign.p 0.0;

                    var v (+  (/ self.computed.cell.top track.computed.inner_size.y))
                    set self.valign.s (clamp v 0.0 1.0)
                }]
                self.add_event_listener "drag_y" [fn (d) {
                    #println "drag_y {d}"
                    #set self.vscroll (- start y.dist)
                    #set self.valign.s (clamp (+ start (/ d.dist track.computed.inner_size.y)) 0.0 1.0)
                    #set self.valign.p (clamp d.dist 0.0 1.0)

                    set self.valign.p d.dist

                }]
    node
        text +
        color blue

apply scroll_body
    text xx
    color 50 50 50
    hfill 1.0
    vfill 1.0
    hexpand 1.0
	width 0
	height 0

apply scroll_template
    node scroll_body
        node body
            halign left
            valign top
    node scroll_vbar




stub body_test_element
	script

	node
		width 150
		height 150
		color blue

template body_test
    gap 10
    color grey

    script
        var w 5, h 5;
        set self.span w;
        for i 0 (* w h) {
            var e (call stub_body_test_element self)
            #println e #.0.color.r
            #set e.0.color.r 1.0

            var s (abs (cos (float i)))
            var t (abs (sin (float i)))

            set e.0.color.r (* 0.8 s)
            set e.0.color.g (* 0.8 s s)
            set e.0.color.b (* 0.8 (- 1.0 t))
        }



node scroll_template
    width 0.8
    height 0.8

    apply body
        template body_test

node fps
    floating
    halign right
    valign top
    color 0.0 0.0 0.0 0.5
    font_size 16
    script
        root.add_event_listener "fps" [fn (fps) {set self.text fps;}]