
apply hscroll_bar
    hfill 1.0

template scroll_widget
	#disabled
	span 2
    width 640
    height 480
    color red
	script
		var hthumb, vthumb, body

	node outer_body
        hfill 1.0
        vfill 1.0
        hexpand 1.0
        vexpand 1.0
		width 0
		height 0
		color grey

		draggable
		pressable

		script
			set self.vscroll.p 0.0
			var start;
			self.add_event_listener "press_begin" [fn () { set start self.vscroll }]
			self.add_event_listener "press_end" [fn () { set start self.vscroll }]

			#self.add_event_listener "click" [fn () {
			#	set self.vscroll (+ self.vscroll 11)
			#	println self.vscroll
			#}]
			self.add_event_listener "drag_y" [fn (d) {
				#set self.vscroll (clamp (+ start scale) 0.0 1.0)
				#set self.vscroll (- start px)
				#println "{px} {scale}"

			}]
		node body

    node scroll_vbar
        vfill 1.0
		span 1

		node scroll_vbar_up
			color gold
			hfill 1.0
			height 20
			pressable
			on press
			    color yellow

		node scroll_vbar_inner
			vexpand 1.0
			vfill 1.0
			color dark_grey

			node scroll_vthumb
				color white
				width 20
				height 20
				draggable
				pressable


				script

					set vthumb self
					set self.valign.s 0.0
					var start;
					self.add_event_listener "press_begin" [fn () { set start self.valign.s }]

					self.add_event_listener "drag_y" [fn (e) {
						var h self.computed.cell.sum_size.y;
						#println "is_custom_alive {e} {}" (is_custom_alive e)
						set self.valign.s (clamp (+ start (? (> h 0.0) (/ e.delta h) 0.0)) 0.0 1.0)
					}]
		node scroll_vbar_down
			color gold
			hfill 1.0
			height 20
			pressable
			on press
				color yellow

	node scroll_hbar
        hfill 1.0

		node scroll_hbar_left
			color gold
			vfill 1.0
			width 20
			pressable
			on press
				color yellow
			script
				var held false

				self.add_event_listener "press_begin" [fn () {
					set held true
				}]

				self.add_event_listener "press_end" [fn () {
					set held false
				}]

				self.add_event_listener "update" [fn (dt) {
					if held {
						set hthumb.halign.s (clamp (- hthumb.halign.s (* dt 0.5)) 0.0 1.0)
					}
				}]
		node scroll_hbar_inner
			hexpand 1.0
			hfill 1.0
			color dark_grey

			node scroll_hthumb
				color white
				width 20
				height 20
				draggable
				pressable

				script
					set hthumb self
					set self.halign.s 0.0
					var start;

					self.add_event_listener "press_begin" [fn () {
						set start self.halign.s
					}]

					self.add_event_listener "drag_x" [fn (e) {
						var w self.computed.cell.sum_size.x;
						set self.halign.s (clamp (+ start (? (> w 0.0) (/ e.delta w) 0.0)) 0.0 1.0)
					}]

		node scroll_hbar_right
			color gold
			vfill 1.0
			width 20
			pressable
			on press
				color yellow
			script
				set self.data.abc 4;
				println "self abc is {}" self.data.abc

				var held false

				self.add_event_listener "press_begin" [fn () {
					set held true
				}]

				self.add_event_listener "press_end" [fn () {
					set held false
				}]

				self.add_event_listener "update" [fn (dt) {
					if held {
						set hthumb.halign.s (clamp (+ hthumb.halign.s (* dt 0.5)) 0.0 1.0)
					}
				}]
	node scroll_corner
		color light_grey
		hfill 1.0
		vfill 1.0


stub thing
	script

	node
		width 100
		height 100
		color blue
node
    template scroll_widget

    apply body

        span 20
        gap 10

        script
			var w 20, h 12;
            for i 0 (* w h) {
                var e (call stub_thing self)

				var s (abs (cos (float i)))
				var t (abs (sin (float i)))

				set e.0.color.r (* 0.8 s)
				set e.0.color.g (* 0.8 s s)
				set e.0.color.b (* 0.8 (- 1.0 t))
            }

